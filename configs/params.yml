seed: 7
hvg_n_top_genes: 2000

spec:
  n_pcs: 30
  dcol_max_cells: 3000
  ari_label_key: "Cell type annotation"
  ari_n_dims: 10
  ad_file: data/interim/weinreb.h5ad

qc:
  min_cells: 500
  min_genes: 200
  max_pct_mt: 15

eggfm_model:
  hidden_dims: [512, 512, 512, 512]
  latent_dim: 64

eggfm_train:
  batch_size: 8192
  num_epochs: 50
  lr: 4.0e-3
  sigma: 0.15
  device: "cuda"
  latent_space: "pca"
  early_stop_patience: 5
  early_stop_min_delta: 0.0
  n_cells_sample: 0

  riemann_reg_type: "hess_smooth"
  riemann_reg_weight: 0.05
  riemann_eps: 0.01
  riemann_n_dirs: 4

  # Iterative density refinement
  n_refinement_steps: 2
  refinement_n_clusters: 32
  refinement_beta_start: 0.0
  refinement_beta_end: 1.0
  refinement_energy_clip: 6.0
  refinement_weight_floor: 1.0e-3

eggfm_diffmap:
  geometry_source: "pca"
  energy_source: "hvg"
  metric_mode: "scm"

  n_neighbors: 30
  n_comps: 30
  device: "cuda"
  hvp_batch_size: 4096
  eps_trunc: "no"
  distance_power: 2.0
  t: 2.0
  norm_type: "l2"

  # SCM hyperparams
  metric_gamma: 1.0
  metric_lambda: 40.0
  # energy_clip_abs: 12.0
  energy_batch_size: 8192

  # Riemannian geometry hyperparams
  tangent_dim: 10
  tangent_eps: 0.01
  tangent_k: 30

  curvature_k: 30
  curvature_scale: 1.0

  normal_k: 30
  normal_weight: 1.0

embedding:
  ad_path: data/interim/weinreb_qc.h5ad
  energy_ckpt: out/models/eggfm/eggfm_energy_weinreb.pt
  out_dir: data/embedding
  k: 30
  n_neighbors: 30
  n_cells_sample: 130800
  seed: 7
  cfg_key: eggfm_diffmap


ti_eval:
  ad_path: data/embedding/weinreb_eggfm_diffmap.h5ad
  embedding_key: X_eggfm_diffmap
  time_key: "Time point"
  cluster_key: "Cell type annotation"
  fate_key: null
  baseline_embedding_key: null
  root_mask_key: null
  n_neighbors: 30
  n_dcs: 10
  max_cells: 0
  out_dir: out/metrics/ti
